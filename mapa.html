<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa - Sistema de Monitoramento</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="styles.css">

</head>
<body>

<div id="sidebar">
  <h2>Meus Paddocks</h2>
  <ul id="paddockList" class="paddock-list"></ul>
  <button onclick="ativarEdicaoCerca()">Criar Nova Cerca</button>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Inicializa mapa
var map = L.map('map').setView([-15.78, -47.93], 5);
L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',{
  maxZoom:19,
  attribution:'© OpenStreetMap contributors'
}).addTo(map);

// Variáveis
let modoEdicaoCerca = false;
let pontosCerca = [];
let cercaAtual = null;
let paddocks = [];

// Renderiza lista de paddocks
function renderPaddocks(){
  const list = document.getElementById('paddockList');
  list.innerHTML = '';
  paddocks.forEach(p => {
    const li = document.createElement('li');
    li.className = 'paddock-item';
    li.innerHTML = `<span>${p.name}</span>
      <div class="options">
        <button class="view">Ver Animais</button>
        <button class="edit">Editar</button>
        <button class="delete">Apagar</button>
      </div>`;

    li.addEventListener('click', e=>{
      if(e.target.tagName==='BUTTON') return;
      const opts = li.querySelector('.options');
      opts.style.display = opts.style.display==='block'?'none':'block';
    });

    li.querySelector('.view').addEventListener('click', ()=> {
      if(p.animals.length === 0) alert(`Não há animais no ${p.name}`);
      else alert(`Animais no ${p.name}:\n- ${p.animals.join('\n- ')}`);
    });

    li.querySelector('.edit').addEventListener('click', ()=>{
      const newName = prompt('Digite o novo nome do paddock:', p.name);
      if(newName){ p.name = newName; renderPaddocks(); }
    });

    li.querySelector('.delete').addEventListener('click', ()=>{
      if(confirm(`Apagar ${p.name}?`)){
        if(p.polygon) map.removeLayer(p.polygon);
        paddocks = paddocks.filter(pd => pd.id !== p.id);
        renderPaddocks();
      }
    });

    list.appendChild(li);
  });
}

// Ativar edição de cerca
function ativarEdicaoCerca(){
  modoEdicaoCerca = true;
  pontosCerca = [];
  if(cercaAtual) map.removeLayer(cercaAtual);
  alert("Clique no mapa para adicionar pontos. Duplo clique para finalizar.");
}

// Clique no mapa adiciona pontos
map.on("click", function(e){
  if(!modoEdicaoCerca) return;
  pontosCerca.push([e.latlng.lat,e.latlng.lng]);
  if(cercaAtual) map.removeLayer(cercaAtual);
  cercaAtual = L.polygon(pontosCerca,{
    color:"yellow", weight:4, fillColor:"rgba(255,255,0,0.2)", fillOpacity:0.3
  }).addTo(map);
});

// Duplo clique finaliza cerca
map.on("dblclick", function(){
  if(modoEdicaoCerca && pontosCerca.length>2){
    if(cercaAtual) map.removeLayer(cercaAtual);
    cercaAtual = L.polygon(pontosCerca,{
      color:"yellow", weight:4, fillColor:"rgba(255,255,0,0.3)", fillOpacity:0.4
    }).addTo(map);

    const nome = prompt("Digite o nome do paddock:");
    if(nome){
      const novo = { id: Date.now(), name: nome, animals: [], polygon: cercaAtual };
      paddocks.push(novo);
      renderPaddocks();
    } else { map.removeLayer(cercaAtual); }

    cercaAtual = null;
    pontosCerca=[];
    modoEdicaoCerca=false;
  }
});

renderPaddocks();
</script>
</body>
</html>




